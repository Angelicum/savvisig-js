!function(){function t(t,i){this.x=t,this.y=i,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*n(this.y);else if(0===this.y)this._length=t,this.x=t*n(this.x);else{var i=Math.abs(this.y/this.x),e=Math.sqrt(Math.pow(t,2)/(1+Math.pow(i,2)));i=i*e;this._length=t,this.x=e*n(this.x),this.y=i*n(this.y)}return this},this.angleTo=function(t){var i=this.getLength()*t.getLength();return 0===i?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/i,-1),1))/Math.PI}}function i(i,n){this.x=i,this.y=n,this.getVectorToCoordinates=function(i,n){return new t(i-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,i){return this.getVectorToCoordinates(t,i).reverse()},this.getVectorToPoint=function(i){return new t(i.x-this.x,i.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function n(t,i,n,e,a){if(this.data=t,this.context=i,t.length)for(var s,o,r=t.length,h=0;h<r;h++){o=(s=t[h]).x.length,n.call(i,s);for(var d=1;d<o;d++)e.call(i,s,d);a.call(i,s)}this.changed=function(){},this.startStrokeFn=n,this.addToStrokeFn=e,this.endStrokeFn=a,this.inStroke=!1,this._stroke=this._lastPoint=null,this.startStroke=function(t){if(t&&"number"==typeof t.x&&"number"==typeof t.y){this._stroke={x:[t.x],y:[t.y]},this.data.push(this._stroke),this._lastPoint=t,this.inStroke=!0;var i=this._stroke,n=this.startStrokeFn,e=this.context;return setTimeout((function(){n.call(e,i)}),3),t}return null},this.addToStroke=function(t){if(this.inStroke&&"number"==typeof t.x&&"number"==typeof t.y&&4<Math.abs(t.x-this._lastPoint.x)+Math.abs(t.y-this._lastPoint.y)){var i=this._stroke.x.length;this._stroke.x.push(t.x),this._stroke.y.push(t.y),this._lastPoint=t;var n=this._stroke,e=this.addToStrokeFn,a=this.context;return setTimeout((function(){e.call(a,n,i)}),3),t}return null},this.endStroke=function(){var t=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,t){var i=this._stroke,n=this.endStrokeFn,e=this.context,a=this.changed;return setTimeout((function(){n.call(e,i),a.call(e)}),3),!0}return null}}function e(t,n,e){var r=this.$parent=$(t);t=this.eventTokens={};this.events=new o(this);var h=$.fn[a]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};for(var u in $.extend(d,function(t){for(var i,n,e=t.css("color"),a=(t=t[0],!1);t&&!n&&!a;){try{i=$(t).css("background-color")}catch(t){i="transparent"}"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(n=i),a=t.body,t=t.parentNode}var s,o;return t=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,a=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,i=void 0,(i=e.match(t))?s={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=e.match(a))&&(s={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}),n?(i=void 0,(i=n.match(t))?o={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=n.match(a))&&(o={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)})):o=s&&127<Math.max.apply(null,[s.r,s.g,s.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255},i=function(t){return"rgb("+[t.r,t.g,t.b].join(", ")+")"},s&&o?(t=Math.max.apply(null,[s.r,s.g,s.b]),s=Math.max.apply(null,[o.r,o.g,o.b]),s={r:s=Math.round(s+-.75*(s-t)),g:s,b:s}):s?(t=1,127<(s=Math.max.apply(null,[s.r,s.g,s.b]))&&(t=-1),s={r:s=Math.round(s+96*t),g:s,b:s}):s={r:191,g:191,b:191},{color:e,"background-color":o?i(o):n,"decor-color":i(s)}}(r)),n&&$.extend(d,n),this.settings=d,e)e.hasOwnProperty(u)&&e[u].call(this,u);this.events.publish(a+".initializing"),this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(r),this.isCanvasEmulator=!1,e=this.canvas=this.initializeCanvas(d),n=$(e),this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(r),this.canvasContext=e.getContext("2d"),n.data(a+".this",this),r=(r=d.lineWidth)?r:Math.max(Math.round(e.width/400),2),d.lineWidth=r,this.lineCurveThreshold=3*d.lineWidth,d.cssclass&&""!=$.trim(d.cssclass)&&n.addClass(d.cssclass),this.fatFingerCompensation=0;r=function(t){var n,e,a=function(a){return a=a.changedTouches&&0<a.changedTouches.length?a.changedTouches[0]:a,new i(Math.round(a.pageX+n),Math.round(a.pageY+e)+t.fatFingerCompensation)},o=new s(750,(function(){t.dataEngine.endStroke()}));return this.drawEndHandler=function(i){try{i.preventDefault()}catch(t){}o.clear(),t.dataEngine.endStroke()},this.drawStartHandler=function(i){i.preventDefault();var s=$(t.canvas).offset();n=-1*s.left,e=-1*s.top,t.dataEngine.startStroke(a(i)),o.kick()},this.drawMoveHandler=function(i){i.preventDefault(),t.dataEngine.inStroke&&(t.dataEngine.addToStroke(a(i)),o.kick())},this}.call({},this);var l=r.drawEndHandler,g=r.drawStartHandler,c=r.drawMoveHandler,f=this.canvas;n=$(f);this.isCanvasEmulator?(n.bind("mousemove."+a,c),n.bind("mouseup."+a,l),n.bind("mousedown."+a,g)):(f.ontouchstart=function(t){f.onmousedown=void 0,f.onmouseup=void 0,f.onmousemove=void 0,this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?-3*d.lineWidth:d.minFatFingerCompensation,g(t),f.ontouchend=l,f.ontouchstart=g,f.ontouchmove=c},f.onmousedown=function(t){f.ontouchstart=void 0,f.ontouchend=void 0,f.ontouchmove=void 0,g(t),f.onmousedown=g,f.onmouseup=l,f.onmousemove=c}),t[a+".windowmouseup"]=h.subscribe(a+".windowmouseup",r.drawEndHandler),this.events.publish(a+".attachingEventHandlers");var p=this,v=(t=d.width.toString(10),a);return"ratio"!==t&&"%"!==t.split("")[t.length-1]||(this.eventTokens[v+".parentresized"]=h.subscribe(v+".parentresized",function(t,i,n){return function(){if((g=i.width())!==n){for(var e in t)t.hasOwnProperty(e)&&(h.unsubscribe(t[e]),delete t[e]);var a=p.settings;for(e in p.$parent.children().remove(),p)p.hasOwnProperty(e)&&delete p[e];e=a.data;var s,o,r,d,u,l,g=1*g/n,c=[];for(o=0,r=e.length;o<r;o++){for(s={x:[],y:[]},d=0,u=(l=e[o]).x.length;d<u;d++)s.x.push(l.x[d]*g),s.y.push(l.y[d]*g);c.push(s)}a.data=c,i[v](a)}}}(this.eventTokens,this.$parent,this.$parent.width(),(this.canvas.width,this.canvas.height)))),this.resetCanvas(d.data),this.events.publish(a+".initialized"),this}var a="jSignature",s=function(t,i){var n;return this.kick=function(){clearTimeout(n),n=setTimeout(i,t)},this.clear=function(){clearTimeout(n)},this},o=function(t){this.topics={},this.context=t||this,this.publish=function(t,i,n,e){if(this.topics[t]){var a,s,o,r,h=this.topics[t],d=Array.prototype.slice.call(arguments,1),u=[];for(s=0,o=h.length;s<o;s++)a=(r=h[s])[0],r[1]&&(r[0]=function(){},u.push(s)),a.apply(this.context,d);for(s=0,o=u.length;s<o;s++)h.splice(u[s],1)}},this.subscribe=function(t,i,n){return this.topics[t]?this.topics[t].push([i,n]):this.topics[t]=[[i,n]],{topic:t,callback:i}},this.unsubscribe=function(t){if(this.topics[t.topic])for(var i=this.topics[t.topic],n=0,e=i.length;n<e;n++)i[n][0]===t.callback&&i.splice(n,1)}},r=function(t){var i=this.canvasContext,n=t.x[0],e=(t=t.y[0],this.settings.lineWidth),a=i.fillStyle;i.fillStyle=i.strokeStyle,i.fillRect(n+e/-2,t+e/-2,e,e),i.fillStyle=a},h=function(n,e){var a,s=new i(n.x[e-1],n.y[e-1]),o=new i(n.x[e],n.y[e]),r=s.getVectorToPoint(o);if(1<e&&(g=(p=new i(n.x[e-2],n.y[e-2])).getVectorToPoint(s)).getLength()>this.lineCurveThreshold){a=2<e?new i(n.x[e-3],n.y[e-3]).getVectorToPoint(p):new t(0,0);var h=.35*g.getLength(),d=g.angleTo(a.reverse()),u=r.angleTo(g.reverse());a=new t(a.x+g.x,a.y+g.y).resizeTo(Math.max(.05,d)*h);var l=new t(g.x+r.x,g.y+r.y).reverse().resizeTo(Math.max(.05,u)*h),g=this.canvasContext,c=(h=p.x,u=p.y,d=s.x,s.y),f=p.x+a.x,p=p.y+a.y;a=s.x+l.x,l=s.y+l.y,g.beginPath(),g.moveTo(h,u),g.bezierCurveTo(f,p,a,l,d,c),g.stroke()}r.getLength()<=this.lineCurveThreshold&&(r=this.canvasContext,p=s.x,s=s.y,a=o.x,o=o.y,r.beginPath(),r.moveTo(p,s),r.lineTo(a,o),r.stroke())},d=function(n){if(0<(o=n.x.length-1)){var e=new i(n.x[o],n.y[o]);if((s=(u=new i(n.x[o-1],n.y[o-1])).getVectorToPoint(e)).getLength()>this.lineCurveThreshold){if(1<o){var a=new t((n=new i(n.x[o-2],n.y[o-2]).getVectorToPoint(u)).x+s.x,n.y+s.y).resizeTo(s.getLength()/2),s=this.canvasContext,o=(n=u.x,u.y),r=e.x,h=e.y,d=u.x+a.x,u=u.y+a.y;a=e.x,e=e.y;s.beginPath(),s.moveTo(n,o),s.bezierCurveTo(d,u,a,e,r,h)}else s=this.canvasContext,n=u.x,u=u.y,o=e.x,e=e.y,s.beginPath(),s.moveTo(n,u),s.lineTo(o,e);s.stroke()}}};e.prototype.resetCanvas=function(t){var i=this.canvas,e=this.settings,s=this.canvasContext,o=this.isCanvasEmulator,u=i.width,l=i.height;s.clearRect(0,0,u+30,l+30),s.shadowColor=s.fillStyle=e["background-color"],o&&s.fillRect(0,0,u+30,l+30),s.lineWidth=Math.ceil(parseInt(e.lineWidth,10)),s.lineCap=s.lineJoin="round",s.strokeStyle=e["decor-color"],s.shadowOffsetX=0,s.shadowOffsetY=0;var g=Math.round(l/5),c=1.5*g,f=l-g;u-=1.5*g,l-=g;s.beginPath(),s.moveTo(c,f),s.lineTo(u,l),s.stroke(),s.strokeStyle=e.color,o||(s.shadowColor=s.strokeStyle,s.shadowOffsetX=.5*s.lineWidth,s.shadowOffsetY=-.6*s.lineWidth,s.shadowBlur=0),t||(t=[]),s=this.dataEngine=new n(t,this,r,h,d),e.data=t,$(i).data(a+".data",t).data(a+".settings",e);var p=this.$parent,v=this.events,y=a;return s.changed=function(){v.publish(y+".change"),p.trigger("change")},s.changed(),!0},e.prototype.initializeCanvas=function(t){var i=document.createElement("canvas"),n=$(i);if(t.width===t.height&&"ratio"===t.height&&(t.width="100%"),n.css("margin",0).css("padding",0).css("border","none").css("height","ratio"!==t.height&&t.height?t.height.toString(10):1).css("width","ratio"!==t.width&&t.width?t.width.toString(10):1),n.appendTo(this.$parent),"ratio"===t.height?n.css("height",Math.round(n.width()/t.sizeRatio)):"ratio"===t.width&&n.css("width",Math.round(n.height()*t.sizeRatio)),n.addClass(a),i.width=n.width(),i.height=n.height(),(t=i).getContext)t=!1;else{var e=(n=t.ownerDocument.parentWindow).FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(!e)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");if(t=e.initElement(t),e=1,n&&n.screen&&n.screen.deviceXDPI&&n.screen.logicalXDPI&&(e=1*n.screen.deviceXDPI/n.screen.logicalXDPI),1!==e)try{$(t).children("object").get(0).resize(Math.ceil(t.width*e),Math.ceil(t.height*e)),t.getContext("2d").scale(e,e)}catch(t){}t=!0}return this.isCanvasEmulator=t,i.onselectstart=function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1},i};var u,l=window,g=function(t,i){var n=new Image,e=this;n.onload=function(){e.getContext("2d").drawImage(n,0,0,n.width<e.width?n.width:e.width,n.height<e.height?n.height:e.height)},n.src="data:"+i+","+t},c=function(t){return this.find("canvas."+a).add(this.filter("canvas."+a)).data(a+".this").resetCanvas(t),this},f=function(t,i){if(void 0!==i||"string"!=typeof t||"data:"!==t.substr(0,5)||(i=t.slice(5).split(",")[0])!==(t=t.slice(6+i.length))){var n=this.find("canvas."+a).add(this.filter("canvas."+a));if(!b.hasOwnProperty(i))throw Error(a+" is unable to find import plugin with for format '"+String(i)+"'");return 0!==n.length&&b[i].call(n[0],t,i,function(t){return function(){return t.resetCanvas.apply(t,arguments)}}(n.data(a+".this"))),this}},p=new o,v=a,y=function(){p.publish(v+".parentresized")};$(l).bind("resize."+v,(function(){u&&clearTimeout(u),u=setTimeout(y,500)})).bind("mouseup."+v,(function(){p.publish(v+".windowmouseup")}));var m={},x={default:function(){return this.toDataURL()},native:function(t){return t},image:function(){var t=this.toDataURL();if("string"==typeof t&&4<t.length&&"data:"===t.slice(0,5)&&-1!==t.indexOf(",")){var i=t.indexOf(",");return[t.slice(5,i),t.substr(i+1)]}return[]}},b={native:function(t,i,n){n(t)},image:g,"image/png;base64":g,"image/jpeg;base64":g,"image/jpg;base64":g},w={export:x,import:b,instance:m},S={init:function(t){return this.each((function(){var i,n=!1;for(i=this.parentNode;i&&!n;)n=i.body,i=i.parentNode;!n||new e(this,t,m)}))},getSettings:function(){return this.find("canvas."+a).add(this.filter("canvas."+a)).data(a+".this").settings},clear:c,reset:c,addPlugin:function(t,i,n){return w.hasOwnProperty(t)&&(w[t][i]=n),this},listPlugins:function(t){var i=[];if(w.hasOwnProperty(t)){var n;t=w[t];for(n in t)t.hasOwnProperty(n)&&i.push(n)}return i},getData:function(t){var i=this.find("canvas."+a).add(this.filter("canvas."+a));if(void 0===t&&(t="default"),0!==i.length&&x.hasOwnProperty(t))return x[t].call(i.get(0),i.data(a+".data"))},importData:f,setData:f,globalEvents:function(){return p},events:function(){return this.find("canvas."+a).add(this.filter("canvas."+a)).data(a+".this").events}};$.fn[a]=function(t){return t&&"object"!=typeof t?"string"==typeof t&&S[t]?S[t].apply(this,Array.prototype.slice.call(arguments,1)):void $.error("Method "+String(t)+" does not exist on jQuery."+a):S.init.apply(this,arguments)}}(),$.fn.jSignature("addPlugin","instance","UndoButton",(function(t){this.events.subscribe("jSignature.attachingEventHandlers",(function(){if(this.settings[t]){var i=this.settings[t];"function"!=typeof i&&(i=function(){var t=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),i=t.width();return t.css("left",Math.round((this.canvas.width-i)/2)),i!==t.width()&&t.width(i),t});var n=i.call(this),e=this;e.events.subscribe("jSignature.change",(function(){e.dataEngine.data.length?n.show():n.hide()}));var a=this,s=(this.events.topics.hasOwnProperty("jSignature.undo")?t:"jSignature")+".undo";n.bind("click",(function(){a.events.publish(s)})),a.events.subscribe(s,(function(){var t=a.dataEngine.data;t.length&&(t.pop(),a.resetCanvas(t))}))}}))})),function(){for(var t={},i={},n=(d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split("")).length/2,e=n-1;-1<e;e--)t[d[e]]=d[e+n],i[d[e+n]]=d[e];var a=function(i){for(var n=(i=i.split("")).length,e=1;e<n;e++)i[e]=t[i[e]];return i.join("")},s=function(t){for(var i,e,s=[],o=0,r=1,h=t.length,d=0;d<h;d++)e=(i=Math.round(t[d]))-o,o=i,0>e&&0<r?(r=-1,s.push("Z")):0<e&&0>r&&(r=1,s.push("Y")),(i=Math.abs(e))>=n?s.push(a(i.toString(n))):s.push(i.toString(n));return s.join("")},o=function(e){for(var a,s=[],o=(e=e.split("")).length,r=1,h=[],d=0,u=0;u<o;u++)(a=e[u])in t||"Z"===a||"Y"===a?(0!==h.length&&(h=parseInt(h.join(""),n)*r+d,s.push(h),d=h),"Z"===a?(r=-1,h=[]):"Y"===a?(r=1,h=[]):h=[a]):h.push(i[a]);return s.push(parseInt(h.join(""),n)*r+d),s},r=function(t){for(var i,n=[],e=t.length,a=0;a<e;a++)i=t[a],n.push(s(i.x)),n.push(s(i.y));return n.join("_")},h=function(t){for(var i=[],n=(t=t.split("_")).length/2,e=0;e<n;e++)i.push({x:o(t[2*e]),y:o(t[2*e+1])});return i},d=function(t){return["image/jsignature;base30",r(t)]};e=function(t,i,n){"string"==typeof t&&("image/jsignature;base30"===t.substring(0,23).toLowerCase()&&(t=t.substring(24)),n(h(t)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var u=this.jQuery.fn.jSignature;u("addPlugin","export","base30",d),u("addPlugin","export","image/jsignature;base30",d),u("addPlugin","import","base30",e),u("addPlugin","import","image/jsignature;base30",e),this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:a,compressstrokeleg:s,uncompressstrokeleg:o,compressstrokes:r,uncompressstrokes:h,charmap:t})}.call("undefined"!=typeof window?window:this),function(){function t(t,i){this.x=t,this.y=i,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*n(this.y);else if(0===this.y)this._length=t,this.x=t*n(this.x);else{var i=Math.abs(this.y/this.x),e=Math.sqrt(Math.pow(t,2)/(1+Math.pow(i,2)));i=i*e;this._length=t,this.x=e*n(this.x),this.y=i*n(this.y)}return this},this.angleTo=function(t){var i=this.getLength()*t.getLength();return 0===i?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/i,-1),1))/Math.PI}}function i(i,n){this.x=i,this.y=n,this.getVectorToCoordinates=function(i,n){return new t(i-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,i){return this.getVectorToCoordinates(t,i).reverse()},this.getVectorToPoint=function(i){return new t(i.x-this.x,i.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function n(t,i){var n=Math.pow(10,i);return Math.round(t*n)/n}function e(e,a,s){a+=1;var o=new i(e.x[a-1],e.y[a-1]),r=new i(e.x[a],e.y[a]),h=(r=o.getVectorToPoint(r),new i(e.x[a-2],e.y[a-2]));return(o=h.getVectorToPoint(o)).getLength()>s?(s=2<a?new i(e.x[a-3],e.y[a-3]).getVectorToPoint(h):new t(0,0),e=.35*o.getLength(),h=o.angleTo(s.reverse()),a=r.angleTo(o.reverse()),s=new t(s.x+o.x,s.y+o.y).resizeTo(Math.max(.05,h)*e),r=new t(o.x+r.x,o.y+r.y).reverse().resizeTo(Math.max(.05,a)*e),r=new t(o.x+r.x,o.y+r.y),["c",n(s.x,2),n(s.y,2),n(r.x,2),n(r.y,2),n(o.x,2),n(o.y,2)]):["l",n(o.x,2),n(o.y,2)]}function a(a,s,o){s=["M",n(a.x[0]-s,2),n(a.y[0]-o,2)],o=1;for(var r=a.x.length-1;o<r;o++)s.push.apply(s,e(a,o,1));return 0<r?s.push.apply(s,function(e,a){var s=e.x.length-1,o=new i(e.x[s],e.y[s]);if(o=(r=new i(e.x[s-1],e.y[s-1])).getVectorToPoint(o),1<s&&o.getLength()>a){s=new i(e.x[s-2],e.y[s-2]).getVectorToPoint(r);var r=o.angleTo(s.reverse()),h=.35*o.getLength();return["c",n((s=new t(s.x+o.x,s.y+o.y).resizeTo(Math.max(.05,r)*h)).x,2),n(s.y,2),n(o.x,2),n(o.y,2),n(o.x,2),n(o.y,2)]}return["l",n(o.x,2),n(o.y,2)]}(a,o)):0===r&&s.push.apply(s,["l",1,1]),s.join(" ")}function s(t){var i,n,e=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],s=t.length,o=[],r=[],h=n=i=0,d=0,u=[];if(0!==s){for(i=0;i<s;i++){d=[],n={x:[],y:[]};var l=void 0,g=void 0;for(l=0,g=(h=t[i]).x.length;l<g;l++)d.push({x:h.x[l],y:h.y[l]});for(l=0,g=(d=simplify(d,.7,!0)).length;l<g;l++)n.x.push(d[l].x),n.y.push(d[l].y);u.push(n),o=o.concat(n.x),r=r.concat(n.y)}t=Math.min.apply(null,o)-1,s=Math.max.apply(null,o)+1,h=0>t?0:t,d=0>(o=Math.min.apply(null,r)-1)?0:o,i=s-t,n=(r=Math.max.apply(null,r)+1)-o}for(e.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+i.toString()+'" height="'+n.toString()+'">'),i=0,s=u.length;i<s;i++)n=u[i],e.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+a(n,h,d)+'"/>');return e.push("</svg>"),e.join("")}function o(t){return[u,s(t)]}function r(t){return[l,d(s(t))]}var h=window;if(("undefined"!=typeof exports?exports:h).simplify=function(t,i,n){if(i=void 0!==i?i*i:1,!n){var e,a=t.length,s=[h=t[0]];for(n=1;n<a;n++){var o=(e=t[n]).x-h.x,r=e.y-h.y;o*o+r*r>i&&(s.push(e),h=e)}h!==e&&s.push(e),t=s}s=(n=(e=t).length)-1;var h,d,u,l=[],g=[],c=[];for((a=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n))[h=0]=a[s]=1;s;){for(r=0,o=h+1;o<s;o++){d=e[o];var f=e[h],p=e[s],v=f.x,y=f.y,m=(f=p.x-v,p.y-y),x=void 0;0===f&&0===m||(1<(x=((d.x-v)*f+(d.y-y)*m)/(f*f+m*m))?(v=p.x,y=p.y):0<x&&(v+=f*x,y+=m*x)),(d=(f=d.x-v)*f+(m=d.y-y)*m)>r&&(u=o,r=d)}r>i&&(a[u]=1,l.push(h),g.push(u),l.push(u),g.push(s)),h=l.pop(),s=g.pop()}for(o=0;o<n;o++)a[o]&&c.push(e[o]);return t=c},"function"!=typeof d)var d=function(t){var i,n,e,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),o=0,r=0,h="";h=[];do{i=(a=(i=t.charCodeAt(o++))<<16|(n=t.charCodeAt(o++))<<8|(e=t.charCodeAt(o++)))>>18&63,n=a>>12&63,e=a>>6&63,a&=63,h[r++]=s[i]+s[n]+s[e]+s[a]}while(o<t.length);return h=h.join(""),((t=t.length%3)?h.slice(0,t-3):h)+"===".slice(t||3)};var u="image/svg+xml",l="image/svg+xml;base64";if("undefined"==typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(h=$.fn.jSignature)("addPlugin","export","svg",o),h("addPlugin","export",u,o),h("addPlugin","export","svgbase64",r),h("addPlugin","export",l,r)}();var SavviSig=function(t,i,n){var e=this;e.uid=0,e.options=$.extend(!0,{required:!1,id:"savvi-siggy",dataImage:!1,dataDate:!1,group:!1,required:!0},t),e.init(i,e.options),$("[data-sig-id]").length||(e.buildSignatureModal(i,e.options),e.bindSignatureModal(i,e.options)),e.buildSignatureField(i,e.options),e.bindSignatureField(i,e.options)};SavviSig.prototype.init=function(t,i){var n=this;if(!n.checkIncludes())return!1;$("body").find("[data-savvisig-id]").each((function(){n.uid++})),$(t).attr("data-savvisig-id",n.uid)},SavviSig.prototype.checkIncludes=function(){var t=!0;return window.jQuery||(console.log("[-] Error: jQuery is not installed."),t=!1),$.isFunction($.fn.modal)||(console.log("[-] Error: bootstrap is not installed."),t=!1),$.isFunction($.fn.jSignature)||(console.log("[-] Error: jSignature is not installed."),t=!1),t},SavviSig.prototype.buildSignatureModal=function(t,i){var n="";n+='<div data-id="sf-modal-sig" class="modal fade" role="dialog" data-owner="'+i.id+'">',n+='<div class="modal-dialog modal-lg">',n+='<form class="sf-sig-form modal-content">',n+='<div class="modal-header">',n+='<button type="button" class="close" data-dismiss="modal">&times;</button>',n+='<h4 class="modal-title">Edit Signature</h4>',n+="</div>",n+='<div class="modal-body">',n+='<div class="sf-sign-area"></div>',n+="</div>",n+='<div class="modal-footer">',n+='<button type="button" class="btn btn-default btn-lg" data-dismiss="modal"><i class="glyphicon glyphicon-remove"></i> Close</button>',n+='<button type="button" data-id="sf-button-sign" class="btn btn-default btn-lg"><i class="glyphicon glyphicon-pencil"></i> Sign</button>',n+="</div>",n+="</form>",n+="</div>",n+="</div>",$("body").append(n)},SavviSig.prototype.buildSignatureField=function(t,i){var n=this,e="",a="",s="";n.options.group&&(a=n.options.group),n.options.required&&(s='required="required"'),"signature"==$(t).attr("data-type")?($(t).attr("data-sig-id",n.uid),$(t).attr("data-group",a),$(t).addClass("sf-signature")):(e+='<div data-sig-id="sig-'+n.uid+'" class="form-group-lg form-group has-feedback sf-signature" data-group="'+a+'">',e+='<span class="glyphicon form-control-feedback glyphicon-ok" aria-hidden="true">',e+="</span>",e+="<input "+s+' id="sf-data-'+n.uid+'" name="sf-data-'+n.uid+'" class="form-control sf-sig-data sf-field" type="text">',e+="<input "+s+' id="sf-data-'+n.uid+'" name="sf-data-'+n.uid+'" class="form-control sf-sig-date sf-field" type="text">',e+='<div class="sf-sig-wrapper" data-action="sign">',e+='<div class="form-control">',e+='<img class="signature-image" src="" />',e+='<div class="sf-sig-note">Sign Here</div>',e+="</div>",e+='<div class="sf-sig-panel">',e+='<button type="button" class="sf-sig-edit btn btn-default btn-lg">Edit</button>',e+="</div>",e+="</div>",e+="</div>",$(t).html(e))},SavviSig.prototype.bindSignatureField=function(t,i){var n=this,e=$('[data-id="sf-modal-sig"]'),a=$(t).find('[data-sig-id="sig-'+n.uid+'"]');"signature"==$(t).attr("data-type")&&(a=$(t));e.find(".sf-sign-area");var s=a.find(".sf-sig-data"),o=a.find(".sf-sig-date"),r=a.find(".sf-sig-panel");s.on("focus",(function(){s.blur()})),o.on("focus",(function(){o.blur()})),n.updateSignature(t,i,i.dataImage,i.dataDate),a.find(".sf-sig-edit").on("click tap",(function(){if(s.is(":disabled")||o.is(":disabled"))return!1;n.openModal(t,i),s.focus()})),a.find('[data-action="sign"]').on("click tap",(function(){if(s.is(":disabled")||o.is(":disabled"))return!1;var e=n.getLatestSig(a);""==e||e==s.val()?n.openModal(t,i):(n.updateSignature(t,i,e,(new Date).toISOString()),s.trigger("change"),s.trigger("blur")),s.focus()})),""!==s.val()&&r.fadeIn("fast")},SavviSig.prototype.getLatestSig=function(t){var i="",n=0,e=t.find(".sf-sig-date");return e.val().length>1&&(n=new Date(e.val())),$("[data-sig-id]").each((function(){var e=$(this),a=e.find(".sf-sig-data"),s=e.find(".sf-sig-date"),o=new Date(s.val());""!==e.attr("data-group")&&e.attr("data-group")==t.attr("data-group")&&o>n&&(n=o,i=a.val())})),i},SavviSig.prototype.openModal=function(t,i){var n=this,e=$('[data-id="sf-modal-sig"]'),a=e.find(".sf-sign-area"),s=e.find('[data-id="sf-button-sign"]'),o=!1;e.off("show.bs.modal"),e.on("show.bs.modal",(function(t){o=!1,a.jSignature("reset"),a.resize(),s[0].disabled=!0,a.off("change"),a.bind("change",(function(t){var i=$(t.target).jSignature("getData","native");i.length>1||1===i.length&&i[0].x.length>5?(o=!0,s[0].disabled=!1):(o=!1,s[0].disabled=!0)}))})),s.off("click tap"),s.on("click tap",(function(){1==o&&(n.updateSignature(t,i,a.jSignature("getData","image"),(new Date).toISOString()),e.modal("hide"))})),e.modal("show")},SavviSig.prototype.updateSignature=function(t,i,n,e){var a=$(t).find('[data-sig-id="sig-'+this.uid+'"]');"signature"==$(t).attr("data-type")&&(a=$(t));var s=a.find(".signature-image"),o=a.find(".sf-sig-data"),r=a.find(".sf-sig-date"),h=a.find(".sf-sig-note"),d=a.find(".sf-sig-panel");if(!n||!e)return!1;s.attr("src","data:"+n),r.val((new Date).toISOString()),o.val(n),h.fadeOut("fast"),d.fadeIn("fast"),o.trigger("change"),o.trigger("blur"),this.resetGroupedSignatures(a)},SavviSig.prototype.resetGroupedSignatures=function(t){var i=t.find(".sf-sig-data");$("[data-sig-id]").each((function(){var n=$(this);""!==n.attr("data-group")&&n.attr("data-group")==t.attr("data-group")&&n.find(".sf-sig-data").val()!==i.val()&&(n.find(".sf-sig-note").fadeIn("fast"),n.find(".sf-sig-date").val(""),n.find(".sf-sig-data").val(""),n.find("img").attr("src",""))})),$(document).trigger("signaturesUpdated")},SavviSig.prototype.bindSignatureModal=function(t,i){var n=$('[data-id="sf-modal-sig"]').find(".sf-sign-area");n.jSignature({height:"350px",width:"100%",color:"#000",lineWidth:2,"decor-color":"transparent"}),n.resize()},jQuery.fn.savviSig=function(t,i){this.each((function(){return new SavviSig(t,this,i)}))};
